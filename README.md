### SAM-TS

#### 概述

我们在原有的师生框架上添加一个分支，即微调的SAM，用以生成高质量伪标签。如图：

![overall__1](https://github.com/NY1006CR/CBCT_Seg/blob/master/PNG/overall__1.jpg)

第一步：在SAM的图像编码器和掩码解码器中配置LoRA层，再结合有标注的数据集进行微调，得到在特定CBCT图像分割任务上表现良好的SAM（如图所示）

![loar_sam__1](https://github.com/NY1006CR/CBCT_Seg/blob/master/PNG/loar_sam__1.jpg)

第二步：用微调后的模型预测我们大量未标注的CBCT图像，得到大量伪标签集合1

第三步：筛选伪标签。（注：第一次迭代过后会有教师模型生成的伪标签集合2，两个集合同时筛选）

第四步：伪标签对学生模型进行监督训练，之后在用ground-truth进行几轮（次数大大小于伪标签训练轮次，实验中我们取十倍，即伪标签进行100个epoch，ground-truth进行10个epoch）

第五步：将学生模型参数以EMA方式传递给教师模型，教师模式预测未标注的CBCT图像生成伪标签集合2，此时进入迭代，重复第2-5步





![pesudo select__1](https://github.com/NY1006CR/CBCT_Seg/blob/master/PNG/pesudo%20select__1.jpg)

##### 实验结果

(1) 将在2个精细标注的CBCT扫描数据集上的SOTA方法进行比较，包括U-Net、U-Net++和Swin-Unet。记录了两个特征（牙齿和骨头）的最大和最小MIoU,目的是测试模型的泛化能力，泛化能力也是对方法评价的重要指标。

| Methods        | MIoU   | tooth(Max/Min)   | bone(Max/Min)    |
| -------------- | ------ | ---------------- | ---------------- |
| U-Net          | 78.84% | (43.91% ,84.15%) | (48.12% ,85.08%) |
| U-Net++        | 79.14% | (50.32% ,85.23%) | (51.82% ,86.82%) |
| Attention-UNet | 80.91% | (54.21% ,85.09%) | (51.73% ,86.46%) |
| U2Net          | 81.10% | (52.01% ,85.31%) | (52.80% ,86.17%) |
| Trans-UNet     | 82.10% | (52.06% ,85.58%) | (51.25% ,88.03%) |
| Swin-UNet      | 82.10% | (52.48% ,86.76%) | (50.81% ,87.96%) |
| MissFormer     | 83.10% | (52.95% ,86.48%) | (51.28% ,87.28%) |
| Ours           | 89.21% | (80.37% ,96.58%) | (83.72% ,95.18%) |

(2) 分别测试了在给予训练不同数据量的情况下，模型的泛化能力以及分割能力。模型选用UNet。

结果分析：

1.6000-8000 miou的增长趋于饱和

2.增加未标注数据量时，MIoU增长明显，min的增长说明了模型的泛化能力极大增强

| Quantity | MIoU   | tooth(Max/Min)   | bone(Max/Min)    |
| -------- | ------ | ---------------- | ---------------- |
| only标注 | 78.84% | (43.91% ,84.15%) | (48.12% ,85.08%) |
| 2000     | 84.21% | (76.92% ,93.18%) | (79.83% ,90.94%) |
| 4000     | 87.21% | (78.37% ,95.92%) | (80.72% ,94.29%) |
| 6000     | 89.42% | (80.15% ,96.59%) | (83.59% ,96.09%) |
| 8000     | 89.58% | (80.27% ,96.48%) | (83.72% ,95.18%) |

(3) 消融实验

纯网络对比原始教师-学生框架 对比 加上SAM模块 （证明教师模块和融合SAM模块分支的有效性）

| Methods       | MIoU   | tooth(Max/Min)   | bone(Max/Min)    |
| ------------- | ------ | ---------------- | ---------------- |
| U-Net         | 78.84% | (43.91% ,84.15%) | (48.12% ,85.08%) |
| +ts_frame     | 81.02% | (53.92% ,86.25%) | (48.92% ,86.15%) |
| +ts_frame+SAM | 89.58% | (80.37% ,96.58%) | (83.72% ,95.18%) |
